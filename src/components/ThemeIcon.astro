---
// 이 컴포넌트는 클라이언트 측 스크립트만 필요하므로
// 프론트매터(---) 부분은 비워둡니다.
---

<label class="flex cursor-pointer gap-2 items-center">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="20"
    height="20"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <circle cx="12" cy="12" r="4"/>
    <path d="M12 2v2"/>
    <path d="M12 20v2"/>
    <path d="M4.93 4.93l1.41 1.41"/>
    <path d="M17.66 17.66l1.41 1.41"/>
    <path d="M2 12h2"/>
    <path d="M20 12h2"/>
    <path d="M4.93 19.07l1.41-1.41"/>
    <path d="M17.66 6.34l1.41-1.41"/>
  </svg>
  <input
    id="themeToggle"
    type="checkbox"
    value="synthwave"
    class="toggle theme-controller"
  />
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="20"
    height="20"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
  </svg>
</label>

<script is:inline>
  const THEMES = {
    LIGHT: "nord",
    DARK: "dracula",
  };

  // 1. 초기 테마 설정
  const getInitialTheme = () => {
    const storedTheme = localStorage.getItem("theme");
    if (storedTheme && Object.values(THEMES).includes(storedTheme)) {
      return storedTheme;
    }

    const prefersDark = window.matchMedia(
      "(prefers-color-scheme: dark)",
    ).matches;

    return prefersDark ? THEMES.DARK : THEMES.LIGHT;
  };

  const theme = getInitialTheme();
  document.documentElement.setAttribute("data-theme", theme);
  localStorage.setItem("theme", theme);

  // 2. 토글 상태 초기화
  const themeToggle = document.getElementById("themeToggle");
  if (themeToggle instanceof HTMLInputElement) {
    themeToggle.checked = theme === THEMES.DARK;
  }

  const handleToggleClick = () => {
    const element = document.documentElement;
    const currentTheme = element.getAttribute("data-theme");
    const newTheme = currentTheme === THEMES.DARK ? THEMES.LIGHT : THEMES.DARK;
    element.setAttribute("data-theme", newTheme);
    localStorage.setItem("theme", newTheme);
  };

  document
    .getElementById("themeToggle")
    ?.addEventListener("click", handleToggleClick);
</script>
