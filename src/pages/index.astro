---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";

const pageTitle = "Iceship's log";

// Fetch all blog posts
const allPosts = await getCollection("blog");

// Sort posts by date in descending order
const sortedPosts = allPosts.sort(
	(a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);
---

<BaseLayout pageTitle={pageTitle}>
	<div>
		{
			sortedPosts.map((post) => (
				<div class="card bg-base-100 w-96 shadow-sm">
					<figure class="h-48 overflow-hidden">
						<Image
							src={post.data.image}
							alt={post.data.alt}
							class="w-full h-full object-cover"
						/>
					</figure>
					<div class="card-body">
						<h2 class="card-title">
							<a href={`/posts/${post.id}`}>{post.data.title}</a>
							<div class="badge badge-secondary">{post.data.targetKeyword}</div>
						</h2>
						<p>{post.data.description}</p>
						<div class="card-actions justify-end">
							{post.data.tags.slice(0, 4).map((tag: string) => (
								<div class="badge badge-outline">{tag}</div>
							))}
						</div>
					</div>
				</div>
			))
		}
	</div>
</BaseLayout>
